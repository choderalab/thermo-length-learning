import yaml 
import sys
import itertools
import os

def run_relative_perturbation(ligA, ligB,tidy=True):
    print('Starting relative calcluation of ligand {} to {}'.format(ligA,ligB))
    trajectory_directory = 'lig{}to{}_1'.format(ligA,ligB) 
    new_yaml = 'vanilla_{}to{}.yaml'.format(ligA,ligB) 
    
    # rewrite yaml file
    with open('vanilla.yaml', "r") as yaml_file:
        options = yaml.load(yaml_file)
    options['old_ligand_index'] = ligA
    options['new_ligand_index'] = ligB
    options['trajectory_directory'] = trajectory_directory
    with open(new_yaml, 'w') as outfile:
        yaml.dump(options, outfile)
    
    # run the simulation
    os.system('python ~/software/perses/perses/app/setup_relative_calculation.py {}'.format(new_yaml))

    print('Relative calcluation of ligand {} to {} complete'.format(ligA,ligB))

    if tidy:
        os.remove(new_yaml)

    return

# work out which ligand pair to run
ligand_pairs = [(0, 35), (0, 49), (0, 115), (0, 425), (1, 33), (1, 57), (1, 73), (1, 76), (1, 106), (1, 157), (1, 164), (1, 186), (1, 225), (1, 253), (1, 265), (1, 343), (1, 368), (1, 381), (1, 397), (1, 504), (1, 520), (1, 534), (1, 536), (1, 554), (1, 569), (1, 629), (2, 202), (2, 429), (2, 538), (3, 145), (3, 195), (3, 227), (3, 453), (3, 594), (4, 125), (4, 151), (4, 217), (4, 260), (4, 319), (4, 472), (4, 489), (5, 122), (5, 248), (5, 340), (5, 446), (5, 448), (5, 504), (5, 518), (5, 534), (5, 566), (5, 596), (6, 11), (6, 52), (6, 129), (6, 144), (6, 190), (6, 247), (6, 279), (6, 401), (6, 458), (6, 494), (6, 510), (6, 526), (6, 563), (7, 56), (7, 82), (7, 88), (7, 93), (7, 96), (7, 104), (7, 112), (7, 121), (7, 178), (7, 428), (7, 487), (7, 537), (7, 639), (8, 136), (8, 250), (8, 257), (8, 545), (9, 110), (9, 122), (9, 201), (9, 248), (9, 370), (9, 444), (9, 445), (9, 448), (9, 622), (10, 314), (10, 623), (11, 48), (11, 52), (11, 92), (11, 129), (11, 168), (11, 190), (11, 251), (11, 279), (11, 401), (11, 458), (11, 467), (11, 472), (11, 494), (11, 526), (11, 552), (11, 560), (11, 563), (11, 571), (12, 353), (13, 14), (13, 40), (13, 65), (13, 76), (13, 85), (13, 93), (13, 96), (13, 175), (13, 186), (13, 241), (13, 266), (13, 326), (13, 427), (13, 475), (13, 500), (13, 597), (13, 599), (13, 610), (14, 40), (14, 63), (14, 65), (14, 76), (14, 85), (14, 93), (14, 96), (14, 104), (14, 175), (14, 186), (14, 241), (14, 249), (14, 266), (14, 295), (14, 326), (14, 397), (14, 427), (14, 457), (14, 459), (14, 475), (14, 500), (14, 505), (14, 597), (14, 599), (14, 610), (17, 38), (17, 57), (17, 99), (17, 106), (17, 326), (17, 359), (17, 378), (17, 403), (17, 457), (17, 506), (18, 130), (19, 229), (19, 517), (21, 63), (21, 69), (21, 235), (21, 249), (21, 295), (21, 392), (23, 562), (24, 118), (24, 305), (24, 382), (24, 396), (24, 565), (24, 567), (24, 613), (27, 51), (27, 52), (27, 66), (27, 74), (27, 86), (27, 124), (27, 127), (27, 163), (27, 168), (27, 191), (27, 192), (27, 196), (27, 215), (27, 244), (27, 251), (27, 277), (27, 299), (27, 335), (27, 352), (27, 356), (27, 452), (27, 530), (27, 560), (27, 612), (28, 102), (28, 216), (28, 342), (28, 515), (28, 638), (29, 256), (29, 339), (30, 84), (30, 103), (30, 204), (30, 210), (30, 270), (30, 294), (30, 608), (30, 620), (31, 118), (31, 155), (31, 172), (31, 263), (31, 264), (31, 315), (31, 382), (31, 406), (31, 573), (31, 578), (33, 57), (33, 65), (33, 73), (33, 76), (33, 157), (33, 225), (33, 253), (33, 265), (33, 343), (33, 397), (33, 536), (33, 554), (33, 569), (33, 629), (34, 51), (34, 98), (34, 116), (34, 143), (34, 162), (34, 180), (34, 187), (34, 191), (34, 215), (34, 251), (34, 271), (34, 299), (34, 435), (34, 452), (34, 498), (34, 560), (34, 580), (34, 612), (35, 138), (35, 425), (36, 450), (37, 88), (37, 100), (37, 112), (37, 268), (37, 272), (37, 329), (37, 388), (37, 431), (37, 454), (37, 585), (37, 591), (37, 592), (38, 57), (38, 73), (38, 99), (38, 106), (38, 201), (38, 326), (38, 359), (38, 403), (38, 457), (38, 475), (38, 506), (38, 632), (38, 634), (39, 553), (40, 65), (40, 76), (40, 85), (40, 93), (40, 96), (40, 99), (40, 175), (40, 178), (40, 186), (40, 241), (40, 253), (40, 266), (40, 324), (40, 326), (40, 427), (40, 459), (40, 475), (40, 500), (40, 528), (40, 568), (40, 595), (40, 597), (40, 599), (40, 603), (40, 610), (41, 67), (41, 68), (41, 72), (41, 101), (41, 105), (41, 164), (41, 233), (41, 265), (41, 306), (41, 308), (41, 334), (41, 343), (41, 368), (41, 439), (41, 460), (41, 461), (41, 469), (41, 548), (41, 551), (42, 302), (42, 555), (43, 110), (43, 248), (43, 444), (43, 454), (44, 115), (44, 117), (44, 229), (44, 340), (44, 373), (44, 375), (44, 425), (44, 518), (46, 162), (46, 244), (46, 391), (46, 486), (46, 498), (46, 521), (46, 580), (47, 339), (47, 470), (48, 92), (48, 168), (48, 251), (48, 277), (48, 458), (48, 462), (48, 467), (48, 472), (48, 492), (48, 526), (48, 552), (48, 560), (48, 571), (49, 59), (49, 115), (49, 220), (49, 222), (49, 300), (49, 321), (49, 468), (49, 512), (51, 86), (51, 98), (51, 162), (51, 187), (51, 191), (51, 215), (51, 251), (51, 299), (51, 356), (51, 452), (52, 66), (52, 74), (52, 124), (52, 127), (52, 129), (52, 163), (52, 168), (52, 190), (52, 192), (52, 196), (52, 244), (52, 251), (52, 271), (52, 277), (52, 279), (52, 335), (52, 352), (52, 401), (52, 458), (52, 494), (52, 526), (52, 530), (52, 560), (52, 563), (52, 612), (55, 500), (55, 505), (55, 610), (55, 639), (56, 65), (56, 82), (56, 88), (56, 91), (56, 93), (56, 104), (56, 112), (56, 121), (56, 178), (56, 329), (56, 487), (56, 537), (56, 639), (57, 73), (57, 76), (57, 99), (57, 105), (57, 106), (57, 157), (57, 225), (57, 253), (57, 265), (57, 280), (57, 326), (57, 343), (57, 359), (57, 378), (57, 381), (57, 397), (57, 403), (57, 457), (57, 460), (57, 506), (57, 520), (57, 536), (57, 554), (57, 564), (57, 569), (57, 629), (57, 634), (59, 70), (59, 128), (59, 220), (59, 222), (59, 254), (59, 298), (59, 300), (59, 308), (59, 385), (59, 400), (59, 439), (59, 468), (59, 512), (59, 519), (59, 548), (59, 557), (59, 607), (59, 635), (62, 144), (62, 247), (62, 261), (62, 438), (62, 510), (63, 85), (63, 104), (63, 249), (63, 295), (63, 459), (63, 505), (64, 98), (64, 116), (64, 167), (64, 180), (64, 234), (64, 342), (64, 418), (64, 486), (64, 530), (64, 638), (65, 76), (65, 85), (65, 93), (65, 96), (65, 175), (65, 186), (65, 241), (65, 266), (65, 326), (65, 427), (65, 475), (65, 500), (65, 597), (65, 599), (65, 610), (66, 74), (66, 92), (66, 124), (66, 127), (66, 163), (66, 168), (66, 182), (66, 192), (66, 196), (66, 212), (66, 244), (66, 251), (66, 276), (66, 277), (66, 304), (66, 335), (66, 352), (66, 353), (66, 492), (66, 494), (66, 530), (66, 560), (66, 612), (67, 68), (67, 72), (67, 101), (67, 105), (67, 164), (67, 233), (67, 306), (67, 334), (67, 343), (67, 368), (67, 439), (67, 460), (67, 461), (67, 469), (67, 548), (67, 551), (67, 564), (68, 72), (68, 101), (68, 105), (68, 128), (68, 164), (68, 233), (68, 306), (68, 334), (68, 343), (68, 368), (68, 439), (68, 460), (68, 461), (68, 469), (68, 534), (68, 542), (68, 548), (68, 551), (68, 554), (68, 564), (69, 130), (69, 235), (69, 392), (70, 128), (70, 220), (70, 254), (70, 298), (70, 308), (70, 385), (70, 400), (70, 439), (70, 519), (70, 557), (70, 607), (70, 635)]
ligand1, ligand2 = ligand_pairs[int(sys.argv[1])-1] # jobarray starts at 1 

run_relative_perturbation(ligand1, ligand2)
